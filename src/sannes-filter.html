
<link rel="import" href="/bower_components/polymer/polymer-element.html">

<link rel="import" href="/bower_components/paper-autocomplete/paper-autocomplete.html">
<link rel="import" href="/bower_components/paper-autocomplete/paper-autocomplete-suggestions.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">

<link rel="import" href="sannes-itemfilter.html">

<dom-module id="sannes-filter">
  <template>
    <style>
      :host{
      }

      #container{
        @apply --shadow-elevation-2dp;
        padding:24px;

      }

      #itemFiltersContainer{
        margin-top:10px;
      }

      #maxCostLabel{
        max-width:130px;
      }

    </style>

    <div id="container">
      <h2>Filter</h2>
      <paper-checkbox checked active="{{showPizzas}}">Visa pizzor</paper-checkbox>
      <paper-input id="maxCostLabel" label="Max kostnad" value="{{maxCostString}}" type="number" max="230"  auto-validate error-message="Maxkostnat för någonting här är 230kr">
        <div slot="suffix">kr</div>
      </paper-input>
      <h3>Filtrera vilka ingredienser du vill ha på din pizza.</h3>
      <div id="itemFiltersContainer">

      </div>
      <div class="autocomplete-wrapper">
        <paper-input id="ingredientInput" label="Lägg till ingrediens"></paper-input>

        <paper-autocomplete-suggestions id="autocompleteSuggestions" for="ingredientInput" highlight-first></paper-autocomplete-suggestions>
      </div>

    </div>
  </template>
  <script>
    class SannesFilter extends Polymer.Element{
      static get is() { return 'sannes-filter'; }

      static get properties() {
        return {
          ingredients:{
            type: Array,
            observer: '_ingredientsUpdated',
            notify: true
          },
          showPizzas:{
            type: Boolean,
            notify: true
          },
          maxCostString:{
            type: String,
            value : "",
            notify:true,
            observer: '_maxCostStringUpdated'
          },
          maxCost:{
            type: Number,
            value: NaN,
            notify: true
          },
          itemFilters:{
            type: Array,
            value: function(){
              return [];
            },
            notify: true
          }
        }
      }

      static get observers() {
        return [
          '_renderItemFilters(itemFilters.splices)'
        ]
      }

      _maxCostStringUpdated(){
        this.maxCost = parseInt(this.maxCostString);
      }

      _ingredientsUpdated(){
        var autocompleteIngredients = [];
        for(var i in this.ingredients){
          autocompleteIngredients.push({
            "text": this._firstLetterUppercase(this.ingredients[i]),
            "value": this.ingredients[i]
          });
        }

        this.$.autocompleteSuggestions.source = autocompleteIngredients;
      }

      ready(){
        super.ready();

        var self = this;
        this.$.autocompleteSuggestions.addEventListener('autocomplete-selected', function (event) {
          var selected = event.detail.text;
          self.push("itemFilters", selected);
        });
      }

      _renderItemFilters(change){
        this.$.ingredientInput.value = "";
        var self = this;
        this.$.itemFiltersContainer.innerHTML = "";
        for(var i in this.itemFilters){
          var  itemFilter = document.createElement("sannes-itemfilter");
          itemFilter.itemName = this.itemFilters[i];
          itemFilter.addEventListener("itemFilterRemoved", function(e){
            var index = self.itemFilters.indexOf(e.detail.itemName);
            self.splice('itemFilters', index, 1);
          });

          this.$.itemFiltersContainer.appendChild(itemFilter);
        }
      }

      _firstLetterUppercase(str){
        return str.charAt(0).toUpperCase() + str.slice(1);
      }


    }

    customElements.define(SannesFilter.is, SannesFilter);
  </script>
</dom-module>
