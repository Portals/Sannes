<link rel="import" href="/bower_components/polymer/polymer-element.html">

<dom-module id="sannes-item">
  <template>
    <style>

      #container{
        @apply --shadow-elevation-2dp;
        width:300px;
        height:150px;
        padding: 8px;
        margin-right: 16px;
        margin-bottom: 16px;
        background-color: white;
      }

      .spicy{
        background-color: var(--google-red-100);
      }
      .veg{
      /*  background-color: var(--google-green-100);*/
      }

      div{
        display:inline-block;
      }

      #header{
        width:100%;
        display:flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 10px;
      }

      #header > *{
        display:inline-block;
        margin:0;
      }

      #ingredients{
        margin-bottom: 10px;
      }

      .hidden{
        display:none;
      }

    </style>

    <div id="container">
      <div id="header">
        <h3>[[itemName]]</h3>
        <h4>[[itemPrice]]</h4>
      </div>
      <div id="ingredients">
        <template is="dom-repeat" items="[[itemData.ingredients]]">
          [[_beautifyIngredient(index, item)]]
        </template>
      </div>
    </div>

  </template>
  <script>
    class SannesItem extends Polymer.Element{
      static get is() { return 'sannes-item'; }

      static get properties() {
        return {
          itemName:{
            type: String,
            notify: true
          },
          itemData:{
            type: Object,
            notify: true
          },
          itemFilters:{
            type: Array,
            notify: true
          },
          itemPrice:{
            type: String,
            notify: true
          },
          maxCost:{
            type: Number,
            notify: true,
          },
          showPizzas:{
            type: Boolean,
            notify: true
          }
        }
      }

      static get observers() {
        return [
          '_updateFilter(itemFilters.splices)',
          '_updateFilter(maxCost)',
          '_updateFilter(showPizzas)',
          '_updateItemPrice(itemData)'
        ]
      }

      ready(){
        super.ready();

        this.itemName = this._firstLetterUppercase(this.itemName);

        if(this.itemData.id != null){
          this.itemName = this.itemData.id + ". " + this.itemName;
        }

        if(this.itemData.spicy){
          this.itemName += " (Stark)";
          this.$.container.classList.add("spicy");
        }

        if(this.itemData.veg){
          this.itemName += " (Veg ðŸ¥—)";
          this.$.container.classList.add("veg");
        }

        switch(this.itemData.type){
          case "baked":
            this.itemName += " (Inbakad)";
            break;
          case "half_baked":
            this.itemName += " (Halv inbakad)";
            break;
        }
      }

      _updateFilter(){
        var hidden = false;
        for(var index in this.itemFilters){
          var itemFilterData = this.itemFilters[index].toLowerCase();

          if(!this.itemData.ingredients.includes(itemFilterData)){
            hidden = true;
            break;
          }
        }

        if(this.maxCost < this.itemData.price
            && (this.itemData.family_price == null
              || this.maxCost < this.itemData.family_price)){
          hidden = true;
        }

        console.log(this.itemData.type + "; " + this.showPizzas);

        const type = this.itemData.type.toLowerCase();

        if((type == "pizza" || type == "half_baked" || type == "baked") && this.showPizzas != undefined && !this.showPizzas){
          hidden = true;
        }

        if(hidden){
          this.$.container.classList.add("hidden");
        }else{
          this.$.container.classList.remove("hidden");
        }
      }

      _updateItemPrice(){
        this.itemPrice = this.itemData.price + "kr" + ((this.itemData.family_price != null)
          ? (" / " + this.itemData.family_price + "kr")
          : "");
      }

      _firstLetterUppercase(str){
        return str.charAt(0).toUpperCase() + str.slice(1);
      }

      _beautifyIngredient(index, str){
        var output = str;

        if(index == 0){
          output = this._firstLetterUppercase(output);
        }

        if(index != this.itemData.ingredients.length - 1){
          output += ", ";
        }

        return output;
      }

      _updateItemFilters(change){

      }
    }

    customElements.define(SannesItem.is, SannesItem);
  </script>
</dom-module>
